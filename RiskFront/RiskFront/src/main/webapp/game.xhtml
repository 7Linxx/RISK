<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<h:head>
  <meta charset="UTF-8"/>
  <title>Juego - Risk</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <h:outputStylesheet name="css/styles.css" library="css"/>
  <h:outputScript name="js/brian/game-map.js" library="js"/>
</h:head>
<h:body style="background-image: url('resources/images/parchment-texture.jpg');">
  <header class="navbar navbar-light bg-white shadow-sm">
    <div class="container">
      <span class="navbar-brand mb-0 h1">Risk</span>
      <div>
        <h:form class="d-inline">
          <h:commandButton value="Guardar" action="#{gameBean.saveGame}" styleClass="btn btn-outline-secondary btn-sm me-2"/>
          <h:commandButton value="Salir" action="main.xhtml?faces-redirect=true" styleClass="btn btn-outline-danger btn-sm"/>
        </h:form>
      </div>
    </div>
  </header>

  <main class="container py-4">
    <div class="row g-3">
      <div class="col-lg-8">
        <div class="card map-placeholder p-2 shadow-sm">
          <h5 class="card-header">Mapa</h5>
          <div class="card-body p-2">
            <h:form id="mapForm">
              <div id="mapContainer" onclick="gameMap.onMapClick(event)" style="cursor:pointer;">
                <!-- Replace this with your SVG map. If SVG, each path should have data-territory-id="arg" etc. -->
                <img src="resources/images/world-map-placeholder.jpg" alt="Mapa" class="img-fluid rounded"/>
              </div>
              <h:inputHidden id="selected" value="#{gameBean.selectedTerritory}" />
              <h:commandButton id="selectBtn" style="display:none" action="#{gameBean.onTerritorySelected}" />
            </h:form>

            <div class="mt-3">
              <small class="text-muted">
                Instrucciones: Fase = #{gameBean.phase}. Haz clic en el mapa o escribe el id cuando el prompt aparezca.
              </small>
            </div>
          </div>
        </div>
      </div>

      <aside class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Turno actual</h5>
            <p class="card-text"><strong>Jugador:</strong> #{gameBean.gameState.currentPlayer.name}</p>
            <p class="card-text"><strong>Tropas disponibles:</strong> #{gameBean.gameState.currentPlayer.availableReinforcements}</p>
            <p class="card-text"><strong>Fase:</strong> #{gameBean.phase}</p>

            <div class="d-grid gap-2 mb-3">
              <h:form>
                <h:commandButton value="Reforzar" action="#{gameBean.reinforcePhase}" styleClass="btn btn-outline-success"/>
                <h:commandButton value="Atacar" action="#{gameBean.attackPhase}" styleClass="btn btn-outline-danger"/>
                <h:commandButton value="Finalizar turno" action="#{gameBean.endTurn}" styleClass="btn btn-success"/>
              </h:form>
            </div>

            <h6>Territorios</h6>
            <div class="small" style="max-height:180px; overflow:auto;">
              <ui:repeat value="#{gameBean.gameState.territories.values().toArray()}" var="t">
                <div class="d-flex justify-content-between border-bottom py-1">
                  <div>#{t.name}</div>
                  <div><span class="badge bg-secondary">#{t.armies}</span></div>
                </div>
              </ui:repeat>
            </div>

            <h6 class="mt-3">Log</h6>
            <div class="log small" style="max-height:160px; overflow:auto;">
              <ui:repeat value="#{gameBean.log}" var="line">
                <div>#{line}</div>
              </ui:repeat>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</h:body>
</html>